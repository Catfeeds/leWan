<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>每日爆款</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/leWan.css" rel="stylesheet" />
		<link href="../../plugins/swiper-4.3.3.min.css" rel="stylesheet" />
		<link href="../../fonts/iconfont.css" rel="stylesheet" />
		<style type="text/css">
			body {
				padding: 0;
				margin: 0;
				background-color: #f8f8f8 !important;
			}
			
			.cardBox{
				background-color: #f8f8f8 !important;
			}
			.cardList {
				height: 6.986rem;
				width: 100%;
				padding: 0.266rem 0.4rem;
				margin-bottom: 0.266rem;
				background-color: #FFFFFF;
				position: relative;
			}
			.cardTitle>span:nth-child(1){
				font-size:  0.4rem;
				color:  #333333;
				font-weight:  500;
			}
			.cardTitle>span:nth-child(2){
				float: right;
				font-size:  0.32rem;
				color:  #999999;
				font-weight:  500;
			}
			.cardImgBox{
				display: flex;
				justify-content: space-between;
				align-items: flex-start;
				margin-top: 0.266rem;
			}
			.cardImgBox>img{
				display: inline-block;
				width:  4.56rem;
				height: 3.066rem;
				border-radius: 0.2rem;
			}
			.cardText{
				margin-top: 0.266rem;
				width: 100%;
				overflow: hidden;
				text-overflow: ellipsis;
				display: -webkit-box;
				-webkit-line-clamp: 3;
				-webkit-box-orient: vertical;
				font-size:  0.32rem;
				color: #666666;
				font-weight: 500;
				line-height: 1.3;
			}
			.footerBox{
				width: 100%;
				position: absolute;
				left: 0;
				bottom: 0;
			}
			.footerBox>span:nth-child(1){
				margin-left: 0.453rem;
				margin-bottom: 0.346rem;
				font-size: 0.426rem ;
				color:  #333333;
				font-weight: bold;
			}
			.footerBox>span:nth-child(2){
				margin-left: 0.4rem;
				margin-bottom: 0.346rem;
				font-size: 0.32rem ;
				color:  #333333;
				font-weight:  500;
			}
			.footerBox>span:nth-child(2)>i{
				color: #FC9929;
				margin-right: 0.133rem;
				font-size: 0.5rem;
			}
			.footerBox>span:nth-child(3){
				float: right;
				margin-right: 0.586rem;
				margin-bottom: 0.266rem;
				display: inline-block;
				width:  2.426rem;
				height:  0.693rem;
				height: 0.693rem;
				text-align: center;
				border-radius:  0.15rem;
				background-color:  #FDD99B ;
				color:  #333333;
				font-size: 0.346rem;
			}
			.footerBox>span:nth-child(3)>i{
				margin-left: 0.106rem;
				font-size: 0.5rem;
			}
		</style>
	</head>

	<body>
		<!--底部导航-->
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item" id="homePage">
				<span class="mui-icon"><i class="iconfont icon-shouye"></i></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item mui-active">
				<span class="mui-icon"><i class="iconfont icon-huo"></i></span>
				<span class="mui-tab-label">分享圈</span>
			</a>
			<a class="mui-tab-item" id="reservationCenter">
				<span class="mui-icon"><i class="iconfont icon-chakantiezishijian"></i></span>
				<span class="mui-tab-label">预约中心</span>
			</a>
			<a class="mui-tab-item" id="personalCenter">
				<span class="mui-icon"><i class="iconfont icon-wode"></i></span>
				<span class="mui-tab-label">我的</span>
			</a>
		</nav>

		<!--卡片-->
		<div class="mui-scroll-wrapper" id="refreshContainer">
			<div class="mui-scroll">
				<div class="" id="J_el">
					<div class="cardBox">
						<div class="cardList">
							<div class="cardTitle">
								<span>发布日期</span>
								<span>2018/11/11 23:56</span>
							</div>
							<div class="cardImgBox">
								<img src="../../img/homePage/register1.png"/>
								<img src="../../img/homePage/register1.png"/>
							</div>
							<div class="cardText">
								古称“古董羹”，因食物投入沸水时发出的“咕咚”声而得名，它是中国独创的美食，历史悠久，是一种老少皆宜的食物。
								古称“古董羹”，因食物投入沸水时发出的“咕咚”声而得名，它是中国独创的美食，历史悠久，是一种老少皆宜的食物。
								据考证，收到睡个好觉都是
							</div>
							<div class="footerBox">
								<span>¥39.9</span>
								<span><i class="iconfont icon-fenxiang"></i>分享赚¥12.5</span>
								<span>一键分享<i class="iconfont icon-fenxiang"></i></span>
							</div>
						</div>
						<div class="cardList">
							<div class="cardTitle">
								<span>发布日期</span>
								<span>2018/11/11 23:56</span>
							</div>
							<div class="cardImgBox">
								<img src="../../img/homePage/register1.png"/>
								<img src="../../img/homePage/register1.png"/>
							</div>
							<div class="cardText">
								古称“古董羹”，因食物投入沸水时发出的“咕咚”声而得名，它是中国独创的美食，历史悠久，是一种老少皆宜的食物。
								古称“古董羹”，因食物投入沸水时发出的“咕咚”声而得名，它是中国独创的美食，历史悠久，是一种老少皆宜的食物。
								据考证，收到睡个好觉都是
							</div>
							<div class="footerBox">
								<span>¥39.9</span>
								<span><i class="iconfont icon-fenxiang"></i>分享赚¥12.5</span>
								<span>一键分享<i class="iconfont icon-fenxiang"></i></span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="../../plugins/flexible.js"></script>
		<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
		<script src="../../plugins/jquery-2.1.4.js"></script>
		<script src="../../plugins/vue.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../plugins/swiper-4.3.3.min.js"></script>
		<script src="../../plugins/serverApi.js"></script>
		<script src="../../plugins/clipboard.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				//第一步===》获取code
				var code = getUrlParam("code")
				log("code+" + code)
				$("#1").text("code+" + code)
				if(!code && !token) {
					log("没有code")
					//					var redirectUrl = "http://cs.lewan6.ren/wechat_html/page/everydayFaddish/everydayFaddish.html"
					//					window.location.replace('https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx9639c4a683f9ce86&redirect_uri='+redirectUrl+'&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect')
					//					$.ajax({
					//						url: API_SERVER + "Wechat/WechatAuthorizeCode",
					//						async: false,
					//						data: {
					//							redirect_url: redirectUrl
					//						},
					//						success: function(data) {
					//							log(data)
					//							if(data.code == 200) {
					//								log("重定向获取code成功跳转到指定页面")
					//							} else {
					//								mui.toast(data.message)
					//							}
					//						}
					//					})
				}

				//第二步===》进入页面授权
				var token = localStorage.getItem("token"); //0009b229c26fb257ab130cec8f313df6
				$("#2").text("token+" + token)

				log("token+" + token)
				if(!token) {
					log("没有token")
					//获取token
					$.ajax({
						url: API_SERVER + "Wechat/WechatAuthorize",
						async: false,
						data: {
							code: code + "&state="
						},
						success: function(data) {
							log(data)
							if(data.code == 200) {
								localStorage.setItem("token", data.data.token); //token
								localStorage.setItem("subscribe", data.data.subscribe ? data.data.subscribe : 0); //是否关注公众号==》等于1 用户已关注公众号
								localStorage.setItem("level", data.data.level); //用户等级==》1=普通用户；2超级达人；3营销达人；4=运营达人；5=玩主
								$("#4").text("level+" + data.data.level)
							} else {
								mui.toast(data.message)
							}
						}
					})
				}
				//第三步==》微信验签==》获取用户定位
				getPosition()

				function getPosition() {
					$.ajax({
						url: API_SERVER + 'Wechat/WechatPosition',
						async: false,
						data: {
							token: token,
							url: "wechat_html/page/homePage/homePage.html"
						},
						success: function(data) {
							if(data.code == 200) {
								log(data);
								wx.config({
									debug: true, // 开启调试模式,调用的所有api的赚回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
									appId: data.data.appId, // 必填，公众号的唯一标识
									timestamp: data.data.timestamp, // 必填，生成签名的时间戳
									nonceStr: data.data.nonceStr, // 必填，生成签名的随机串
									signature: data.data.signature, // 必填，签名
									jsApiList: ['chooseImage', 'uploadImage', 'downloadImage', // 必填，需要使用的JS接口列表
										'previewImage', 'openLocation', 'getLocation',
										'scanQRCode', 'checkJsApi', 'onMenuShareTimeline',
										'onMenuShareAppMessage', 'onMenuShareQQ',
										'onMenuShareWeibo', 'onMenuShareQZone'
									]
								});
								
								//获取地理位置接口
								wx.getLocation({
									type: 'wgs84', // 默认为wgs84的gps坐标，如果要赚回直接给openLocation用的火星坐标，可传入'gcj02'
									success: function(res) {
										alert(res)
										var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
										var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
										var speed = res.speed; // 速度，以米/每秒计
										var accuracy = res.accuracy; // 位置精度
									},
									cancel: function (res) {
								       alert('用户拒绝授权获取地理位置');
								    }
								});
							}
						}
					});
				}

			});
		</script>
	</body>

</html>